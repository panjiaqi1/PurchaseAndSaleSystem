<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.demo.mapper.InOutMapper">

    <resultMap id="inOutResultMap" type="com.example.demo.entity.InOut">
        <id property="id" column="id"/>
        <result property="amount" column="amount"/>
        <result property="inputOrOutput" column="inputOrOutput"/>
        <result property="createTime" column="create_time"/>
        <association property="good" javaType="Good">
            <id property="id" column="good_id"/>
            <result property="name" column="p_name"/>
        </association>
        <association property="user" javaType="User">
            <id property="id" column="user_id"/>
            <result property="name" column="u_name"/>
        </association>
    </resultMap>

    <select id="findAll" resultMap="inOutResultMap" parameterType="org.springframework.data.domain.Pageable"
            resultType="InOut">
        SELECT in_out.amount,
        in_out.create_time,
        in_out.id,
        in_out.good_id,
        in_out.user_id
        FROM in_out LEFT OUTER JOIN good ON in_out.good_id = good.id
        <where>
            in_out.input_or_output =
            <if test="inPut">
                0
            </if>
            <if test="!inPut">
                1
            </if>
            <if test="goodId != null">
                and in_out.good_id = #{goodId,jdbcType=INTEGER}
            </if>
        </where>
        <if test="pageable != null">
            <bind name="size" value="pageable.getPageSize()"/>
            <if test="pageable.sort != null">
                <foreach collection="pageable.sort" item="sort" index="index">
                    <if test="index == 0">
                        order by
                    </if>
                    <if test="index > 0">
                        ,
                    </if>
                    ${sort.property} ${sort.direction.name}
                </foreach>
            </if>
            limit #{pageable.offset} , ${size}
        </if>
    </select>

    <select id="findById" resultMap="inOutResultMap">
          SELECT in_out.amount,
            in_out.create_time,
            in_out.id,
            in_out.good_id,
            in_out.user_id
        FROM in_out LEFT OUTER JOIN good ON in_out.good_id = good.id
        WHERE in_out.id = #{id,jdbcType=INTEGER};
    </select>

    <insert id="save" parameterType="com.example.demo.entity.InOut">
        insert into in_out (amount, be_input, create_time, good_id, user_id)
        values (#{amount,jdbcType=INTEGER},#{beInput,jdbcType=INTEGER},#{createTime,jdbcType=INTEGER},#{goodId,jdbcType=INTEGER},#{userId,jdbcType=INTEGER})
    </insert>
</mapper>